/**
 * Carbon.JS - A simple JavaScript framework
 *
 * Carbon.JS Animation Module - Basic animation functions with transition curves
 *
 * @author		Dmitry Polyuhov <admin@carbonjs.com>
 * @license		http://carbonjs.com/mit-license.txt
 * @version		1.1.0 (build 20100321)
 */
CarbonJS.modules.animation=true;CarbonJS.Transitions={};CarbonJS.Transitions.types={Line:function(a){return a},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a){return Math.pow(a,2)*(2.618*a-1.618)},Quad:function(a){return Math.pow(a,2)},Cubic:function(a){return Math.pow(a,3)},Quart:function(a){return Math.pow(a,4)},Quint:function(a){return Math.pow(a,5)},Bounce:function(f){var e;for(var d=0,c=1;1;d+=c,c/=2){if(f>=(7-4*d)/11){e=c*c-Math.pow((11-6*d-11*f)/4,2);break}}return e}};for(var t in CarbonJS.Transitions.types){CarbonJS.Transitions[t]={};CarbonJS.Transitions[t].EaseIn=function(a){return this(a)}.bind(CarbonJS.Transitions.types[t]);CarbonJS.Transitions[t].EaseOut=function(a){return 1-this(1-a)}.bind(CarbonJS.Transitions.types[t]);CarbonJS.Transitions[t].EaseInOut=function(a){return(a<=0.5)?this(2*a)/2:(2-this(2*(1-a)))/2}.bind(CarbonJS.Transitions.types[t])}CarbonJS.extend({change:function(e,c,d){CarbonJS.checkModules("utilities");var a=null;var b=null;var g=null;var h=function(l,k,m){this.st=new Date().getTime();this.time=k;this.curve=l;this.callback=m;var j=this;this.runCallback=function(n,o){j.start(n,o)}};h.prototype.start=function(j,k){if(k.animation==null||!this.hasNext()){k.animation=null;if(g!=null&&!!j){g.apply(k)}return}this.callback(this.next());setTimeout(function(){this.runCallback(j,k)}.bind(this),10);if(b!=null){b.apply(k)}};h.prototype.hasNext=function(){if(this.done){return this.oneLeft}var j=new Date().getTime();if((j-this.st)>this.time){this.done=true;this.oneLeft=true}return true};h.prototype.next=function(){this.oneLeft=false;var k=new Date().getTime();var j=Math.min(1,(k-this.st)/this.time);return this.curve(j)};var f=function(j){var k=j.replace(/[# ]/g,"").replace(/^(.)(.)(.)$/,"$1$1$2$2$3$3").match(/.{2}/g);return{r:parseInt(k[0],16),g:parseInt(k[1],16),b:parseInt(k[2],16)}};var i={};this.forEach(function(){i[this]={};i[this].num=0;for(var l in e){if(l!="onStart"&&l!="onChanging"&&l!="onChanged"){i[this].num++}}var j=1;var k=this;k.animation=true;for(var l in e){if(typeof e[l]=="function"){if(l=="onStart"){a=e[l]}if(l=="onChanging"){b=e[l]}if(l=="onChanged"){g=e[l]}e[l]=null}if(e[l]!=null){new h(c,d,function(m){if(!this.name){this.name=k}if(!this.parm){this.parm=e[l]}if(!this.p){if(l!="MozOpacity"&&l!="KhtmlOpacity"){this.p=l.replace(/\-(\w)/g,function(){return arguments[1].toUpperCase()})}else{this.p=l}}if(this.p.search(/[Cc]olor/)!=-1){if(!this.r){this.r=0}if(!this.g){this.g=0}if(!this.b){this.b=0}var p=f(this.parm[0]);var n=f(this.parm[1]);this.r=Math.floor((n.r-p.r)*m+p.r);if(this.r<0){this.r=0}if(this.r>255){this.r=255}this.g=Math.floor((n.g-p.g)*m+p.g);if(this.g<0){this.g=0}if(this.g>255){this.g=255}this.b=Math.floor((n.b-p.b)*m+p.b);if(this.b<0){this.b=0}if(this.b>255){this.b=255}this.name.style[this.p]="rgb("+this.r+","+this.g+","+this.b+")"}else{if(this.p=="opacity"){if(document.body.filters){var o=(parseInt(this.parm[1])-parseInt(this.parm[0]))*m+parseInt(this.parm[0]);if(o>100){o=100}if(o<0){o=0}this.name.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+o+")"}else{var q="";if(typeof document.body.style.MozOpacity=="string"){q="MozOpacity"}else{if(typeof document.body.style.KhtmlOpacity=="string"){q="KhtmlOpacity"}else{if(typeof document.body.style.opacity=="string"){q="opacity"}}}var o=(parseInt(this.parm[1])-parseInt(this.parm[0]))*m+parseInt(this.parm[0]);if(o>100){o=100}if(o<0){o=0}this.name.style[q]=o/100}}else{this.name.style[this.p]=(parseInt(this.parm[1])-parseInt(this.parm[0]))*m+parseInt(this.parm[0])+"px"}}}).start(j==i[k].num,k)}j++}if(a!=null){a.apply(this)}});return this},stopChanging:function(){this.forEach(function(){this["animation"]=null});return this},draggable:function(E){CarbonJS.checkModules("utilities");var s=true,y,v,g,f,C,F,z,B,d,p,o,w,A,n,a,k,i,e,c,m,l,j,h;if(E){g=E.dragX||true;f=E.dragY||true;C=parseInt(E.maxX)||99999;F=parseInt(E.minX)||-99999;z=parseInt(E.maxY)||99999;B=parseInt(E.minY)||-99999;d=E.method||"simple";p=E.onClicked||null;o=E.onDragging||null;w=E.onDropped||null;j=E.grid!=null?parseInt(E.grid[0]):50;h=E.grid!=null?parseInt(E.grid[1]):50}else{g=true;f=true}var b=Q(this[0]);if(d=="reverse"){var x=b.x();var u=b.y()}a=(E&&E.handler!=null)?E.handler:b;var G=0,D=0;var r=function(H){if(H>C){return C}if(H<F){return F}if(d=="grid"){if(o!=null){if(G!=j*Math.round(H/j)){o.apply(b);G=j*Math.round(H/j)}}return j*Math.round(H/j)}else{if(d!="grid"){return H}}};var q=function(H){if(H>z){return z}if(H<B){return B}if(d=="grid"){if(o!=null){if(D!=h*Math.round(H/h)){o.apply(b);D=h*Math.round(H/h)}}return h*Math.round(H/h)}else{if(d!="grid"){return H}}};a.css({cursor:"move"}).addEvent("mousedown",function(H){if(H.preventDefault){H.preventDefault()}else{H.returnValue=false}if(d=="ghostly"){A=b[0].cloneNode(true);document.body.appendChild(A);Q(A).transparence(50)}k=Q().x(H);i=Q().y(H);if(b.css("position")!="absolute"){b.css({position:"absolute",top:b.y(),left:b.x()})}if(p!=null){p.apply(b)}n=(d=="ghostly")?Q(A):b;y=Q().x(H)-n.x();v=Q().y(H)-n.y();e=Q().x(H);c=Q().y(H);s=true;Q(document).addEvent("selectstart",function(){return false}).addEvent("mousemove",function(I){m=Q().x(I);l=Q().y(I);if(m>k){e+=m-k}else{if(k>m){e-=k-m}}if(l>i){c+=l-i}else{if(i>l){c-=i-l}}k=m;i=l;if(s){if(g==true){n.x(r(e-y))}if(f==true){n.y(q(c-v))}if(/simple|reverse/.test(d)&&o!=null){o.apply(b)}}}).addEvent("mouseup",function(){s=false;if(d=="ghostly"){var I=n.x();var J=n.y();A.parentNode.removeChild(A);b.change({top:[b.y(),J],left:[b.x(),I],onChanging:function(){if(o!=null){o.apply(b)}},onChanged:function(){if(w!=null){w.apply(b)}}},CarbonJS.Transitions.Sine.EaseOut,1000)}if(d=="reverse"){b.change({top:[b.y(),u],left:[b.x(),x]},CarbonJS.Transitions.Quart.EaseOut,1000)}if(d!="ghostly"&&w!=null){w.apply(b)}Q(document).removeEvent("mouseup").removeEvent("mousemove").removeEvent("selectstart")})});return this},resizable:function(x){CarbonJS.checkModules("utilities");var q=true,v,s,y,B,h,i,p,c,g,m,l,f,d,o,n,E=x.handlers;var k=this,a,F,w,e,u,r;y=parseInt(x.maxW)||9999;B=parseInt(x.minW)||10;h=parseInt(x.maxH)||9999;i=parseInt(x.minH)||10;p=x.onClicked||null;c=x.onResizing||null;g=x.onResized||null;var b=Q(this[0]);var C=function(G,H){if(H>B&&H<y){k.parentNode().x(G)}};var A=function(H,G){if(G>i&&G<h){k.parentNode().y(H)}};var D=function(G){if(G>y){return y}if(G<B){return B}return G};var j=function(G){if(G>h){return h}if(G<i){return i}return G};var z=function(H,G,I){w=parseInt(k.css("width"));e=parseInt(k.css("height"));u=k.x();r=k.y();dhx=parseInt(H.css("left"));dhy=parseInt(H.css("top"));if(G.preventDefault){G.preventDefault()}else{G.returnValue=false}m=Q().x(G);l=Q().y(G);if(H.css("position")!="absolute"){H.css({position:"absolute",top:H.y(),left:H.x()})}if(p!=null){p.apply(k)}v=Q().x(G)-H.x();s=Q().y(G)-H.y();f=Q().x(G);d=Q().y(G);q=true;Q(document).addEvent("selectstart",function(){return false}).addEvent("mousemove",function(L){o=Q().x(L);n=Q().y(L);if(o>m){f+=o-m}else{if(m>o){f-=m-o}}if(n>l){d+=n-l}else{if(l>n){d-=l-n}}m=o;l=n;if(q){switch(I){case"lt":var J=f-v-dhx;var N=d-s-dhy;var K=w+u-J;var M=e+r-N;C(J,K);A(N,M);k.css({width:D(K),height:j(M)});break;case"t":var N=d-s-dhy;var M=e+r-N;A(N,M);k.css({height:j(M)});break;case"rt":var J=f-v-dhx;var N=d-s-dhy;var M=e+r-N;A(N,M);k.css({width:D(J-u+dhx),height:j(M)});break;case"r":var J=f-v-dhx;k.css({width:D(J-u+dhx)});break;case"rb":var J=f-v-dhx;var N=d-s-dhy;k.css({width:D(J-u+dhx),height:j(N-r+dhy)});break;case"b":var N=d-s-dhy;k.css({height:j(N-r+dhy)});break;case"lb":var J=f-v-dhx;var N=d-s-dhy;var K=w+u-J;C(J,K);k.css({width:D(K),height:j(N-r+dhy)});break;case"l":var J=f-v-dhx;var K=w+u-J;C(J,K);k.css({width:D(K)});break}if(c!=null){c.apply(k)}}}).addEvent("mouseup",function(){q=false;if(g!=null){g.apply(k)}Q(document).removeEvent("mouseup").removeEvent("mousemove").removeEvent("selectstart")})};if(E.lt){E.lt.css({cursor:"nw-resize"}).addEvent("mousedown",function(G){z(E.lt,G,"lt")})}if(E.t){E.t.css({cursor:"n-resize"}).addEvent("mousedown",function(G){z(E.t,G,"t")})}if(E.rt){E.rt.css({cursor:"ne-resize"}).addEvent("mousedown",function(G){z(E.rt,G,"rt")})}if(E.r){E.r.css({cursor:"e-resize"}).addEvent("mousedown",function(G){z(E.r,G,"r")})}if(E.rb){E.rb.css({cursor:"se-resize"}).addEvent("mousedown",function(G){z(E.rb,G,"rb")})}if(E.b){E.b.css({cursor:"s-resize"}).addEvent("mousedown",function(G){z(E.b,G,"b")})}if(E.lb){E.lb.css({cursor:"sw-resize"}).addEvent("mousedown",function(G){z(E.lb,G,"lb")})}if(E.l){E.l.css({cursor:"w-resize"}).addEvent("mousedown",function(G){z(E.l,G,"l")})}return this}});